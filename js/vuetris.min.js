Vue.component("vuetris",{template:"#vuetris-template"});var Vuetris=new Vue({el:"#vuetris",data:{Block:[],Blocks:[],Board:[],BlockClass:"vuetris-block",Interval:!1,Score:0,ScoreText:"SCORE: ",ScoreClass:"",Text:[{text:"SCORE: 0",className:this.ScoreClass}],PointVal:10,MinY:1,MaxX:9,MaxY:15,BlockSize:25,DropPace:250},methods:{createBoard:function(t){var e=[];for(i=0;i<=this.MaxX;){var s=[];for(i2=0;i2<=this.MaxY;)s.push(0),i2++;e.push(s),i++}this.Board=e,$.each(this.Blocks,function(i,t){var e=t.x/Vuetris.BlockSize,s=t.y/Vuetris.BlockSize;Vuetris.Board=Vuetris.fillPosition(e,s,!1),Vuetris.completeLine(s)}),t&&this.createShape(this.newX(),this.MinY,!1)},start:function(){this.Interval&&(clearInterval(Vuetris.Interval),clearInterval(this.Interval),this.Interval=!1),this.reset(),this.createBoard(!0)},pause:function(){this.Interval?(clearInterval(Vuetris.Interval),clearInterval(this.Interval),this.Interval=!1):this.Interval=setInterval(function(){Vuetris.dropBlocks()},this.DropPace)},dropBlocks:function(){if(this.Block.length>0){var i=0,t=0,e=!1,s=!1,o=!0;$.each(this.Block,function(a,l){0==t&&(e=l.x/Vuetris.BlockSize,s=l.y/Vuetris.BlockSize);var c=l.x/Vuetris.BlockSize,r=l.y/Vuetris.BlockSize+1,n=Vuetris.isPositionFilled(c,r),h=Vuetris.canMove(l.x,l.y+Vuetris.BlockSize);0==o||n||!h?1==o&&(Vuetris.Blocks=Vuetris.Blocks.concat(Vuetris.Block),Vuetris.Block=[],i=t,o=!1):(e=l.x/Vuetris.BlockSize,s=l.y/Vuetris.BlockSize),t++}),1==o?this.shapeDown():s<this.MinY+1?this.pause():this.createBoard(!0)}},shapeDown:function(){$.each(this.Block,function(i,t){t.y+=Vuetris.BlockSize})},shapeLeft:function(){var i=!0;$.each(this.Block,function(t,e){var s=e.x-Vuetris.BlockSize,o=Vuetris.canMove(s,e.y),a=Vuetris.isPositionFilled(s/Vuetris.BlockSize,e.y/Vuetris.BlockSize);(0==o||1==a)&&(i=!1)}),i&&$.each(this.Block,function(i,t){t.x-=Vuetris.BlockSize})},shapeRight:function(){var i=!0;$.each(this.Block,function(t,e){var s=e.x+Vuetris.BlockSize,o=Vuetris.canMove(s,e.y),a=Vuetris.isPositionFilled(s/Vuetris.BlockSize,e.y/Vuetris.BlockSize);(0==o||1==a)&&(i=!1)}),i&&$.each(this.Block,function(i,t){t.x+=Vuetris.BlockSize})},shapeRotate:function(){var i=!0,t=!1,e=0;$.each(this.Block,function(i,s){0==e&&(t=s),e++});var s=this.rotateShape(t.blockType,t.x/this.BlockSize,t.y/this.BlockSize,!t.isRotated,!0);$.each(s,function(t,e){var s=Vuetris.canMove(e.x,e.y),o=Vuetris.isPositionFilled(e.x/Vuetris.BlockSize,e.y/Vuetris.BlockSize);o&&(i=!1),s||(i=!1)}),i?this.rotateShape(t.blockType,t.x/this.BlockSize,t.y/this.BlockSize,!t.isRotated,!1):this.rotateShape(t.blockType,t.x/this.BlockSize,t.y/this.BlockSize,t.isRotated,!1)},rotateShape:function(i,t,e,s,o){switch(this.Block=[],i){case"block":default:return Vuetris.newBlock(t,e,s,o);case"l":return Vuetris.newL(t,e,s,o);case"line":return Vuetris.newLine(t,e,s,o);case"slant":return Vuetris.newSlant(t,e,s,o)}},canMove:function(i,t){return i/this.BlockSize<0||i/this.BlockSize>this.MaxX||t/this.BlockSize<this.MinY||t/this.BlockSize>this.MaxY?!1:!0},isPositionFilled:function(i,t){var e=!1;return this.Board.length>0&&$.each(this.Board,function(s,o){s==i&&o.length>0&&$.each(o,function(i,s){i==t&&1==s&&(e=!0)})}),e},fillPosition:function(i,t,e){var s=[];return $.each(this.Board,function(o,a){var l=[];$.each(a,function(s,a){s==t&&(o==i&&e?a=0:o!=i||e||(a=1)),l.push(a)}),s.push(l)}),s},completeLine:function(t){var e=[],s=!0,o=!0;for(this.pause(),i=0;i<this.MaxX;){var a=this.isPositionFilled(i,t);a?o=!1:(s=!1,e.push(i)),i++}1==s&&(this.Blocks.concat(this.Block),$.each(this.Blocks,function(i,e){yPos=e.y/Vuetris.BlockSize,xPos=e.x/Vuetris.BlockSize,yPos==t&&(Vuetris.Board=Vuetris.fillPosition(xPos,yPos,!0),e.y=(Vuetris.MaxY+1)*Vuetris.BlockSize)}),$.each(this.Blocks,function(i,e){yPos=e.y/Vuetris.BlockSize,xPos=e.x/Vuetris.BlockSize,t>yPos&&(Vuetris.Board=Vuetris.fillPosition(xPos,yPos,!0),e.y+=Vuetris.BlockSize,yPos++,Vuetris.Board=Vuetris.fillPosition(xPos,yPos,!1))}),this.addPoints()),this.pause()},add:function(i,t,e,s){this.Block.push({x:i,y:t,width:this.BlockSize-1,height:this.BlockSize-1,className:this.BlockClass+" "+e,blockType:e,isRotated:s})},createShape:function(i,t,e){switch(0==e&&(e=Math.floor(4*Math.random()+1)),e){case 4:this.newSlant(i,t,!1,!1);break;case 3:this.newLine(i,t,!1,!1);break;case 2:this.newL(i,t,!1,!1);break;case 1:default:this.newBlock(i,t,!1,!1)}},newX:function(){return Math.floor(Math.random()*this.MaxX+0)},addPoints:function(){this.Score+=this.PointVal,this.Text=[{text:this.ScoreText+this.Score,className:this.ScoreClass}]},reset:function(){this.Interval&&(clearInterval(Vuetris.Interval),clearInterval(this.Interval),this.Interval=!1),this.Block=[],this.Blocks=[],this.Score=0,this.Text=[{text:"SCORE: 0",className:this.ScoreClass}],this.Interval=setInterval(function(){Vuetris.dropBlocks()},this.DropPace)},newBlock:function(i,t,e,s){for(;i>=this.MaxX;)i--;var o=i*this.BlockSize,a=t*this.BlockSize,l=o+this.BlockSize,c=a+this.BlockSize;return s?[{x:o,y:a},{x:l,y:a},{x:l,y:c},{x:o,y:c}]:(this.add(o,a,"block",e),this.add(l,a,"block",e),this.add(l,c,"block",e),this.add(o,c,"block",e),void 0)},newL:function(i,t,e,s){for(;i>this.MaxX-2;)i--;var o=i*this.BlockSize,a=o+this.BlockSize,l=t*this.BlockSize;if(0==e){var c=a+this.BlockSize,r=l+this.BlockSize;if(s)return[{x:o,y:l},{x:a,y:l},{x:c,y:l},{x:c,y:r}];this.add(o,l,"l",e),this.add(a,l,"l",e),this.add(c,l,"l",e),this.add(c,r,"l",e)}else{var a=o-this.BlockSize,r=l+this.BlockSize,n=r+this.BlockSize;if(s)return[{x:o,y:l},{x:o,y:r},{x:o,y:n},{x:a,y:n}];this.add(o,l,"l",e),this.add(o,r,"l",e),this.add(o,n,"l",e),this.add(a,n,"l",e)}},newLine:function(i,t,e,s){for(;i>this.MaxX-3;)i--;var o=i*this.BlockSize,a=t*this.BlockSize;if(1==e){var l=a+this.BlockSize,c=l+this.BlockSize,r=c+this.BlockSize;if(s)return[{x:o,y:a},{x:o,y:l},{x:o,y:c},{x:o,y:r}];this.add(o,a,"line",e),this.add(o,l,"line",e),this.add(o,c,"line",e),this.add(o,r,"line",e)}else{var n=o+this.BlockSize,h=n+this.BlockSize,u=h+this.BlockSize;if(s)return[{x:o,y:a},{x:n,y:a},{x:h,y:a},{x:u,y:a}];this.add(o,a,"line",e),this.add(n,a,"line",e),this.add(h,a,"line",e),this.add(u,a,"line",e)}},newSlant:function(i,t,e,s){for(;i>this.MaxX-2;)i--;var o=i*this.BlockSize,a=t*this.BlockSize;if(0==e){var l=o+this.BlockSize,c=l+this.BlockSize,r=a+this.BlockSize;if(s)return[{x:o,y:a},{x:l,y:a},{x:l,y:r},{x:c,y:r}];this.add(o,a,"slant",e),this.add(l,a,"slant",e),this.add(l,r,"slant",e),this.add(c,r,"slant",e)}else{var r=a+this.BlockSize,n=r+this.BlockSize,l=o+this.BlockSize;if(s)return[{x:o,y:a},{x:o,y:r},{x:l,y:r},{x:l,y:n}];this.add(o,a,"slant",e),this.add(o,r,"slant",e),this.add(l,r,"slant",e),this.add(l,n,"slant",e)}}}});